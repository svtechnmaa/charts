---
# Source: topology-app/templates/seed-configs-cm.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: seed-configs
  labels:
    app.kubernetes.io/instance: topo
    app.kubernetes.io/managed-by: Helm
data:
  seed-groups.yaml: |-
    Group:
      - ID: 1
        Name: Admin
        Type: B
      - ID: 2
        Name: User
        Type: B
      - ID: 3
        Name: Readonly
        Type: B
      - ID: 4
        Name: Datasource manager
        Type: C
  seed-users.yaml: |-
    User:
      - ID: 1
        Name: admin
        Email: admin@example.com
        Password: adminpassword
        Groups:
          - ID: 1
      - ID: 2
        Name: user
        Email: user@example.com
        Password: userpassword
        Groups:
          - ID: 2
          - ID: 3
      - ID: 3
        Name: readonly
        Email: readonly@example.com
        Password: readonlypassword
        Groups:
          - ID: 3
      - ID: 4
        Name: dsmanager
        Email: dsmanager@example.com
        Password: dsmgrpassword
        Groups:
          - ID: 4
  seed-resource-types.yaml: |-
    ResourceType:
      - ID: 1
        Name: User
      - ID: 2
        Name: Group
      - ID: 3
        Name: Permission
      - ID: 4
        Name: MenuItem
      - ID: 5
        Name: AppMenuItem
      - ID: 6
        Name: Dashboard
      - ID: 7
        Name: AppDashboard
      - ID: 8
        Name: Datasource
      - ID: 9
        Name: Query
      - ID: 10
        Name: Graph
      - ID: 11
        Name: State
      - ID: 12
        Name: Mapping
      - ID: 13
        Name: Template
      - ID: 14
        Name: Icon
      - ID: 15
        Name: AppGraph
  seed-permissions.yaml: |-
    Permission:
      - ID: 1
        GroupID: 1
        ResourceTypeID: 1
        Read: true
        Write: true
      - ID: 2
        GroupID: 1
        ResourceTypeID: 2
        Read: true
        Write: true
      - ID: 3
        GroupID: 1
        ResourceTypeID: 3
        Read: true
        Write: true
      - ID: 4
        GroupID: 1
        ResourceTypeID: 4
        Read: true
        Write: true
      - ID: 5
        GroupID: 1
        ResourceTypeID: 5
        Read: true
        Write: true
      - ID: 6
        GroupID: 1
        ResourceTypeID: 6
        Read: true
        Write: true
      - ID: 7
        GroupID: 1
        ResourceTypeID: 7
        Read: true
        Write: true
      - ID: 8
        GroupID: 1
        ResourceTypeID: 8
        Read: true
        Write: true
      - ID: 9
        GroupID: 1
        ResourceTypeID: 9
        Read: true
        Write: true
      - ID: 10
        GroupID: 1
        ResourceTypeID: 10
        Read: true
        Write: true
      - ID: 11
        GroupID: 1
        ResourceTypeID: 11
        Read: true
        Write: true
      - ID: 12
        GroupID: 1
        ResourceTypeID: 12
        Read: true
        Write: true
      - ID: 13
        GroupID: 1
        ResourceTypeID: 13
        Read: true
        Write: true
      - ID: 14
        GroupID: 1
        ResourceTypeID: 14
        Read: true
        Write: true
      - ID: 15
        GroupID: 2
        ResourceTypeID: 1
        Read: false
        Write: false
      - ID: 16
        GroupID: 2
        ResourceTypeID: 2
        Read: false
        Write: false
      - ID: 17
        GroupID: 2
        ResourceTypeID: 3
        Read: false
        Write: false
      - ID: 18
        GroupID: 2
        ResourceTypeID: 4
        Read: false
        Write: false
      - ID: 19
        GroupID: 2
        ResourceTypeID: 5
        Read: true
        Write: false
      - ID: 20
        GroupID: 2
        ResourceTypeID: 6
        Read: false
        Write: false
      - ID: 21
        GroupID: 2
        ResourceTypeID: 7
        Read: true
        Write: true
      - ID: 22
        GroupID: 2
        ResourceTypeID: 8
        Read: false
        Write: false
      - ID: 23
        GroupID: 2
        ResourceTypeID: 9
        Read: false
        Write: false
      - ID: 24
        GroupID: 2
        ResourceTypeID: 10
        Read: true
        Write: false
      - ID: 25
        GroupID: 2
        ResourceTypeID: 11
        Read: false
        Write: false
      - ID: 26
        GroupID: 2
        ResourceTypeID: 12
        Read: false
        Write: false
      - ID: 27
        GroupID: 2
        ResourceTypeID: 13
        Read: false
        Write: false
      - ID: 28
        GroupID: 2
        ResourceTypeID: 14
        Read: false
        Write: false
      - ID: 29
        GroupID: 3
        ResourceTypeID: 1
        Read: true
        Write: false
      - ID: 30
        GroupID: 3
        ResourceTypeID: 2
        Read: true
        Write: false
      - ID: 31
        GroupID: 3
        ResourceTypeID: 3
        Read: true
        Write: false
      - ID: 32
        GroupID: 3
        ResourceTypeID: 4
        Read: true
        Write: false
      - ID: 33
        GroupID: 3
        ResourceTypeID: 5
        Read: true
        Write: false
      - ID: 34
        GroupID: 3
        ResourceTypeID: 6
        Read: true
        Write: false
      - ID: 35
        GroupID: 3
        ResourceTypeID: 7
        Read: true
        Write: false
      - ID: 36
        GroupID: 3
        ResourceTypeID: 8
        Read: true
        Write: false
      - ID: 37
        GroupID: 3
        ResourceTypeID: 9
        Read: true
        Write: false
      - ID: 38
        GroupID: 3
        ResourceTypeID: 10
        Read: true
        Write: false
      - ID: 39
        GroupID: 3
        ResourceTypeID: 11
        Read: true
        Write: false
      - ID: 40
        GroupID: 3
        ResourceTypeID: 12
        Read: true
        Write: false
      - ID: 41
        GroupID: 3
        ResourceTypeID: 13
        Read: true
        Write: false
      - ID: 42
        GroupID: 3
        ResourceTypeID: 14
        Read: true
        Write: false
      - ID: 43
        GroupID: 1
        ResourceTypeID: 15
        Read: true
        Write: true
      - ID: 44
        GroupID: 2
        ResourceTypeID: 15
        Read: true
        Write: true
      - ID: 45
        GroupID: 3
        ResourceTypeID: 15
        Read: true
        Write: false
      - ID: 46
        GroupID: 4
        ResourceTypeID: 8
        Read: true
        Write: true
      - ID: 47
        GroupID: 4
        ResourceTypeID: 9
        Read: true
        Write: true
      - ID: 48
        GroupID: 4
        ResourceTypeID: 12
        Read: true
        Write: true
  seed-dashboards.yaml: |-
    {
      "Dashboard": [
        {
          "ID": 1,
          "Name": "test",
          "Payload": "{\"layout\":\"2x2\",\"A[layout]\":\"single\",\"A[A][url]\":\"https://example.com\",\"A[A][title]\":\"Example\",\"A[A][external]\":\"true\",\"A[B][url]\":\"\",\"A[B][title]\":\"\",\"A[B][external]\":\"false\",\"A[C][url]\":\"\",\"A[C][title]\":\"\",\"A[C][external]\":\"false\",\"A[D][url]\":\"\",\"A[D][title]\":\"\",\"A[D][external]\":\"false\",\"B[layout]\":\"single\",\"B[A][url]\":\"\",\"B[A][title]\":\"\",\"B[A][external]\":\"false\",\"B[B][url]\":\"\",\"B[B][title]\":\"\",\"B[B][external]\":\"false\",\"B[C][url]\":\"\",\"B[C][title]\":\"\",\"B[C][external]\":\"false\",\"B[D][url]\":\"\",\"B[D][title]\":\"\",\"B[D][external]\":\"false\",\"C[layout]\":\"single\",\"C[A][url]\":\"\",\"C[A][title]\":\"\",\"C[A][external]\":\"false\",\"C[B][url]\":\"\",\"C[B][title]\":\"\",\"C[B][external]\":\"false\",\"C[C][url]\":\"\",\"C[C][title]\":\"\",\"C[C][external]\":\"false\",\"C[D][url]\":\"\",\"C[D][title]\":\"\",\"C[D][external]\":\"false\",\"D[layout]\":\"single\",\"D[A][url]\":\"\",\"D[A][title]\":\"\",\"D[A][external]\":\"false\",\"D[B][url]\":\"\",\"D[B][title]\":\"\",\"D[B][external]\":\"false\",\"D[C][url]\":\"\",\"D[C][title]\":\"\",\"D[C][external]\":\"false\",\"D[D][url]\":\"\",\"D[D][title]\":\"\",\"D[D][external]\":\"false\"}",
          "CreatedBy": 1
        }
      ]
    }
  seed-menu-items.yaml: |-
    {
      "MenuItem": [
        {
          "ID": 1,
          "Title": "Dashboard",
          "Permalink": "",
          "Href": "/app",
          "Order": 0,
          "Username": null,
          "Password": null,
          "ExternalTab": false,
          "Hidden": false,
          "Override": null
        },
        {
          "ID": 2,
          "Title": "Visualizer",
          "Permalink": "",
          "Href": "/app/visualizer",
          "Order": 1,
          "Username": null,
          "Password": null,
          "ExternalTab": false,
          "Hidden": false,
          "Override": null
        },
        {
          "ID": 6,
          "Title": "Gitlist",
          "Permalink": "gitlist",
          "Href": "http://gitlist:80/gitlist/",
          "Order": 5,
          "Username": "",
          "Password": "",
          "ExternalTab": false,
          "Hidden": false,
          "Override": null
        },
        {
          "ID": 4,
          "Title": "Grafana",
          "Permalink": "grafana",
          "Href": "http://grafana:3000/grafana/",
          "Order": 3,
          "Username": "",
          "Password": "",
          "ExternalTab": false,
          "Hidden": false,
          "Override": null
        },
        {
          "ID": 3,
          "Title": "Icingaweb",
          "Permalink": "icingaweb",
          "Href": "http://icingaweb:8080/icingaweb/",
          "Order": 2,
          "Username": "",
          "Password": "",
          "ExternalTab": false,
          "Hidden": false,
          "Override": null
        },
        {
          "ID": 5,
          "Title": "Rundeck",
          "Permalink": "rundeck",
          "Href": "http://rundeck:4440/rundeck",
          "Order": 4,
          "Username": "",
          "Password": "",
          "ExternalTab": false,
          "Hidden": false,
          "Override": null
        }
      ]
    }
  seed-datasources.yaml: |-
    {
      "Datasource": [
        {
          "ID": 2,
          "ParentID": null,
          "ExternalID": null,
          "Title": "Arango-Storage",
          "Type": "Arango",
          "Url": "https://arangodb:8529",
          "Storage": true,
          "Username": "",
          "Password": "",
          "Details": null,
          "Schema": "_system",
          "Query": ""
        },
        {
          "ID": 3,
          "ParentID": null,
          "ExternalID": null,
          "Title": "Arango-Topo",
          "Type": "Arango",
          "Url": "https://arangodb:8529",
          "Storage": false,
          "Username": "",
          "Password": "",
          "Details": null,
          "Schema": "svtech",
          "Query": ""
        },
        {
          "ID": 4,
          "ParentID": null,
          "ExternalID": null,
          "Title": "Icinga-Redis",
          "Type": "Redis",
          "Url": "redis://icinga2:6379",
          "Storage": false,
          "Username": "",
          "Password": "",
          "Details": null,
          "Schema": "0",
          "Query": ""
        },
        {
          "ID": 5,
          "ParentID": null,
          "ExternalID": null,
          "Title": "Internal-Grafana",
          "Type": "Grafana",
          "Url": "http://grafana:3000/grafana/",
          "Storage": false,
          "Username": "",
          "Password": "",
          "Details": null,
          "Schema": "0",
          "Query": ""
        },
        {
          "ID": 1,
          "ParentID": null,
          "ExternalID": null,
          "Title": "Redis",
          "Type": "Redis",
          "Url": "redis://redis:6379",
          "Storage": true,
          "Username": "",
          "Password": "",
          "Details": null,
          "Schema": "0",
          "Query": ""
        }
      ]
    }
  seed-states.yaml: |-
    {
      "State": [
        {
          "ID": 1,
          "Name": "Ok",
          "Order": 0,
          "Payload": '
            {
              "edge": {
                "labelCfg": {
                  "autoRotate": true,
                  "position": "center",
                  "style": {
                    "background": {
                      "padding": [3, 6, 3, 6],
                      "radius": 0
                    },
                    "fontSize": 14,
                    "fontStyle": "bold",
                    "opacity": 1
                  }
                },
                "style": {
                  "endArrow": {
                    "fill": "#00ff29",
                    "path": "M 0,0 L 12,-4 L 12,4 Z",
                    "stroke": "#00ff29"
                  },
                  "lineDash": [],
                  "lineWidth": 5,
                  "startArrow": false,
                  "stroke": "#00ff29",
                  "strokeOpacity": 1
                }
              },
              "node": {
                "clipCfg": {
                  "r": 30,
                  "show": true,
                  "type": "circle",
                  "x": 0,
                  "y": -3
                },
                "img": "/public/router-big_ok.svg",
                "labelCfg": {
                  "offset": 12,
                  "position": "bottom",
                  "style": {
                    "background": {
                      "padding": [3, 6, 3, 6],
                      "radius": 0
                    },
                    "fillOpacity": 0.8,
                    "fontSize": 14,
                    "fontStyle": "bold",
                    "opacity": 1
                  }
                },
                "size": [45, 30],
                "style": {
                  "lineDash": []
                },
                "type": "image"
              }
            }',
          "IsAbnormal": false
        },
        {
          "ID": 2,
          "Name": "Warning",
          "Order": 0,
          "Payload": '
            {
              "edge": {
                "haloColor": "#ff0000",
                "labelCfg": {
                  "autoRotate": true,
                  "position": "center",
                  "style": {
                    "background": {
                      "padding": [3, 6, 3, 6]
                    },
                    "fillOpacity": 1,
                    "fontSize": 14,
                    "fontStyle": "bold",
                    "opacity": 1
                  }
                },
                "style": {
                  "endArrow": {
                    "fill": "#fff500",
                    "path": "M 0,0 L 12,-4 L 12,4 Z",
                    "stroke": "#fff500"
                  },
                  "lineDash": [],
                  "lineWidth": 5,
                  "startArrow": {
                    "fill": "#fff500",
                    "path": "M 0,0 L 12,-4 L 12,4 Z",
                    "stroke": "#fff500"
                  },
                  "stroke": "#fff500",
                  "strokeOpacity": 1
                }
              },
              "node": {
                "clipCfg": {
                  "r": 30,
                  "show": true,
                  "type": "circle",
                  "x": 0,
                  "y": -3
                },
                "haloColor": "#fae106",
                "img": "/public/router-big_warning.svg",
                "labelCfg": {
                  "offset": 12,
                  "position": "bottom",
                  "style": {
                    "background": {
                      "padding": [3, 6, 3, 6]
                    },
                    "fillOpacity": 1,
                    "fontSize": 14,
                    "fontStyle": "bold",
                    "opacity": 1
                  }
                },
                "size": [45, 30],
                "style": {
                  "fillOpacity": 1,
                  "lineDash": [],
                  "opacity": 1,
                  "strokeOpacity": 0.1
                },
                "type": "image"
              }
            }',
          "IsAbnormal": false
        },
        {
          "ID": 3,
          "Name": "Critical",
          "Order": 0,
          "Payload": '
            {
              "edge": {
                "haloColor": "#ff0000",
                "labelCfg": {
                  "autoRotate": true,
                  "style": {
                    "background": {
                      "padding": [3, 6, 3, 6]
                    },
                    "fontSize": 14,
                    "fontStyle": "bold"
                  }
                },
                "style": {
                  "endArrow": {
                    "fill": "#ff0000",
                    "path": "M 0,0 L 12,-4 L 12,4 Z",
                    "stroke": "#ff0000"
                  },
                  "lineDash": [],
                  "lineWidth": 5,
                  "startArrow": {
                    "fill": "#ff0000",
                    "path": "M 0,0 L 12,-4 L 12,4 Z",
                    "stroke": "#ff0000"
                  },
                  "stroke": "#ff0000"
                }
              },
              "node": {
                "clipCfg": {
                  "r": 30,
                  "show": true,
                  "type": "circle",
                  "x": 0,
                  "y": -3
                },
                "haloColor": "#ff0000",
                "img": "/public/router-big_critical.svg",
                "labelCfg": {
                  "offset": 12,
                  "position": "bottom",
                  "style": {
                    "background": {
                      "padding": [3, 6, 3, 6]
                    },
                    "fillOpacity": 1,
                    "fontSize": 14,
                    "fontStyle": "bold",
                    "opacity": 1
                  }
                },
                "size": [45, 30],
                "style": {
                  "fillOpacity": 1,
                  "lineDash": [],
                  "opacity": 1,
                  "strokeOpacity": 0.1
                },
                "type": "image"
              }
            }',
          "IsAbnormal": false
        },
        {
          "ID": 4,
          "Name": "Down",
          "Order": 0,
          "Payload": '
            {
              "edge": {
                "haloColor": "#ff0000",
                "labelCfg": {
                  "autoRotate": true,
                  "position": "center",
                  "style": {
                    "background": {
                      "padding": [3, 6, 3, 6]
                    },
                    "fill": "#000000",
                    "fontSize": 14,
                    "fontStyle": "bold"
                  }
                },
                "style": {
                  "endArrow": {
                    "fill": "#ffffff",
                    "path": "M 0,0 L 12,-4 L 12,4 Z",
                    "stroke": "#ffffff"
                  },
                  "lineDash": [],
                  "lineWidth": 5,
                  "startArrow": false,
                  "stroke": "#ffffff"
                }
              },
              "node": {
                "clipCfg": {
                  "r": 30,
                  "show": true,
                  "type": "circle",
                  "x": 0,
                  "y": -3
                },
                "haloColor": "#000000",
                "img": "/public/router-big_down.svg",
                "labelCfg": {
                  "offset": 12,
                  "position": "bottom",
                  "style": {
                    "background": {
                      "padding": [3, 6, 3, 6]
                    },
                    "fillOpacity": 1,
                    "fontSize": 14,
                    "fontStyle": "bold",
                    "opacity": 1
                  }
                },
                "size": [45, 30],
                "style": {
                  "lineDash": [],
                  "lineWidth": 1,
                  "strokeOpacity": 0.1
                },
                "type": "image"
              }
            }',
          "IsAbnormal": false
        },
        {
          "ID": 5,
          "Name": "Unknown",
          "Order": 0,
          "Payload": '
            {
              "edge": {
                "haloColor": "#ffffff",
                "labelCfg": {
                  "autoRotate": true,
                  "position": "center",
                  "style": {
                    "background": {
                      "padding": [3, 6, 3, 6]
                    },
                    "fontSize": 14,
                    "fontStyle": "bold"
                  }
                },
                "style": {
                  "endArrow": {
                    "fill": "#fa00ff",
                    "path": "M 0,0 L 12,-4 L 12,4 Z",
                    "stroke": "#fa00ff"
                  },
                  "lineDash": [],
                  "lineWidth": 5,
                  "startArrow": {
                    "fill": "#fa00ff",
                    "path": "M 0,0 L 12,-4 L 12,4 Z",
                    "stroke": "#fa00ff"
                  },
                  "stroke": "#fa00ff",
                  "strokeOpacity": 1
                }
              },
              "node": {
                "clipCfg": {
                  "r": 30,
                  "show": true,
                  "type": "circle",
                  "x": 0,
                  "y": -3
                },
                "haloColor": "#ba00fb",
                "img": "/public/router-big_unknown.svg",
                "labelCfg": {
                  "offset": 12,
                  "position": "bottom",
                  "style": {
                    "background": {
                      "padding": [3, 6, 3, 6]
                    },
                    "fillOpacity": 1,
                    "fontSize": 14,
                    "fontStyle": "bold"
                  }
                },
                "size": [45, 30],
                "style": {
                  "fillOpacity": 1,
                  "lineDash": [],
                  "lineWidth": 1,
                  "opacity": 1,
                  "strokeOpacity": 0.1
                },
                "type": "image"
              }
            }',
          "IsAbnormal": false
        }
      ]
    }
  seed-templates.yaml: |-
    {
          "Template": [
            {
              "ID": 1,
              "Name": "Default",
              "Order": 0,
              "Payload": '
            {
              "graphLevelStyle": {
                "node": {
                  "manualStyle": {
                    "size": [45, 30],
                    "style": {
                      "fillOpacity": 1,
                      "lineDash": [],
                      "strokeOpacity": 1,
                      "lineWidth": 1,
                      "opacity": 1
                    },
                    "type": "image",
                    "img": "/public/router-big_ok.svg"
                  },
                  "manualLabelCfg": {
                    "style": {
                      "fontSize": 14,
                      "fillOpacity": 1,
                      "fontStyle": "bold",
                      "opacity": 1,
                      "background": {
                        "padding": [3, 6, 3, 6]
                      }
                    },
                    "offset": 12
                  }
                },
                "edge": {
                  "manualStyle": {
                    "style": {
                      "lineWidth": 5,
                      "lineDash": [],
                      "stroke": "#00ff29",
                      "strokeOpacity": 1,
                      "startArrow": false,
                      "arrowOffset": 13,
                      "endArrow": {
                        "fill": "#00ff29",
                        "stroke": "#00ff29",
                        "path": "M 0,0 L 12,-4 L 12,4 Z"
                      }
                    }
                  },
                  "manualLabelCfg": {
                    "style": {
                      "fontSize": 14,
                      "fillOpacity": 1,
                      "fontStyle": "bold",
                      "opacity": 1,
                      "background": {
                        "padding": [3, 6, 3, 6]
                      }
                    },
                    "position": "center",
                    "autoRotate": true
                  }
                },
                "subMap": {
                  "type": "cCircle",
                  "fixCollapseSize": 10,
                  "padding": 30,
                  "style": {
                    "fillOpacity": 0.1,
                    "lineDash": [],
                    "stroke": "#1400ff",
                    "strokeOpacity": 1,
                    "lineWidth": 5
                  },
                  "labelCfg": {
                    "style": {
                      "fontSize": 14,
                      "fillOpacity": 1,
                      "fontStyle": "bold",
                      "background": {
                        "padding": [6, 14, 4, 14],
                        "radius": 0
                      }
                    },
                    "position": "top"
                  }
                }
              },
              "metaEdgeCfg": [
                {
                  "queryId": "2",
                  "queryFormat": "${source_hostname}|${source_address}|IfCheck-${physical_interface}",
                  "alias": "redis_ifcheck_id"
                },
                {
                  "queryId": "4",
                  "queryFormat": "${redis_ifcheck_id}",
                  "alias": "redis_ifcheck_state"
                },
                {
                  "queryId": "5",
                  "queryFormat": "${source_hostname}|IfCheck-${physical_interface}",
                  "alias": "in_ultilization"
                },
                {
                  "queryId": "6",
                  "queryFormat": "${source_hostname}|IfCheck-${physical_interface}",
                  "alias": "out_ultilization"
                },
                {
                  "queryId": "9",
                  "queryFormat": "${source_hostname}|IfCheck-${physical_interface}|OpticRX",
                  "alias": "RX"
                },
                {
                  "queryId": "10",
                  "queryFormat": "${source_hostname}|IfCheck-${physical_interface}|OpticTX",
                  "alias": "TX"
                }
              ],
              "nodeMetricConfigs": [
                {
                  "url": "https://192.168.1.1/grafana/d-solo/device-detail/device-detail?var-hostgroup=$__all&var-hostname={{hostname}}&orgId=1&from=now-24h&to=now&timezone=browser&var-interface=$__all&var-FPC=$__all&var-rp=six_months&var-service=$__all&panelId=2&__feature.dashboardSceneSolo",
                  "{{hostname}}": "hostname"
                }
              ],
              "edgeMetricConfigs": [
                {
                  "url": "https://192.168.1.1/grafana/d-solo/aeivihvpya8lce/interface-detail?orgId=1&from=now-24h&to=now&timezone=browser&var-hostgroup=$__all&var-hostname={{source_hostname}}&var-service={{interface_name}}&var-command=Interface-check-command&var-perf=OpticRX&var-rp=six_months&panelId=3&__feature.dashboardSceneSolo",
                  "{{hostname}}": "hostname",
                  "{{interface_name}}": "physical_interface",
                  "{{source_hostname}}": "source_hostname"
                }
              ],
              "metaNodeCfg": [
                {
                  "queryId": "1",
                  "queryFormat": "${hostname}|${address}",
                  "alias": "redis_host_id"
                },
                {
                  "queryId": "3",
                  "queryFormat": "${redis_host_id}",
                  "alias": "redis_host_state"
                },
                {
                  "queryId": "11",
                  "queryFormat": "${hostname}|${address}",
                  "alias": "critical_service_count"
                },
                {
                  "queryId": "12",
                  "queryFormat": "${hostname}|${address}",
                  "alias": "warning_service_count"
                },
                {
                  "queryId": "13",
                  "queryFormat": "${hostname}|${address}",
                  "alias": "red_alarm_count"
                },
                {
                  "queryId": "14",
                  "alias": "yellow_alarm_count",
                  "queryFormat": "${hostname}|${address}"
                }
              ],
              "nodeRuleCfg": [
                {
                  "expression": "redis_host_state=1",
                  "state": 4
                },
                {
                  "expression": "critical_service_count.number_service_critical > 0 || red_alarm_count.number_red_alarm > 0",
                  "state": 3
                },
                {
                  "expression": "warning_service_count.number_service_warning > 0 || yellow_alarm_count.number_yellow_alarm > 0",
                  "state": 2
                },
                {
                  "expression": "redis_host_state=0",
                  "state": 1
                },
                {
                  "expression": "id is defined",
                  "state": 1
                }
              ],
              "edgeRuleCfg": [
                {
                  "expression": "redis_ifcheck_state=2",
                  "state": 3
                },
                {
                  "expression": "redis_ifcheck_state=1",
                  "state": 2
                },
                {
                  "expression": "redis_ifcheck_state=0",
                  "state": 1
                },
                {
                  "expression": "id is defined",
                  "state": 5
                }
              ]
            }',
              "IsGlobal": false,
              "Default": false
            }
          ]
        }
  seed-icons.yaml: |-
    {
      "Icon": [
        {
          "ID": 1,
          "Name": "Critical",
          "URL": "/public/router-big_critical.svg"
        },
        {
          "ID": 2,
          "Name": "Down",
          "URL": "/public/router-big_down.svg"
        },
        {
          "ID": 3,
          "Name": "Error",
          "URL": "/public/router-big_error.svg"
        },
        {
          "ID": 4,
          "Name": "Ok",
          "URL": "/public/router-big_ok.svg"
        },
        {
          "ID": 5,
          "Name": "Pending",
          "URL": "/public/router-big_pending.svg"
        },
        {
          "ID": 6,
          "Name": "Unknown",
          "URL": "/public/router-big_unknown.svg"
        },
        {
          "ID": 7,
          "Name": "Unreachable",
          "URL": "/public/router-big_unreachable.svg"
        },
        {
          "ID": 8,
          "Name": "Warning",
          "URL": "/public/router-big_warning.svg",
        }
      ]
    }
  seed-queries.yaml: |-
    {
      "Query": [
        {
          "ID": 1,
          "Name": "icingadb_host_id",
          "ParentDatasourceName": "Grafana",
          "DatasourceName": "IcingaDB",
          "Content": "SELECT name, address, LOWER(HEX(id)) FROM host;",
          "ResultMapper": "//function(result) { _.forEach(result.results.A.frames[0].data.values[0], function(hostname, index) { var address = result.results.A.frames[0].data.values[1][index]; var host_id = result.results.A.frames[0].data.values[2][index]; emit([hostname, address].join('|'), { host_id: host_id}) }) }\nfunction(result) { _.forEach(result.results.A.frames[0].data.values[0], function(hostname, index) { var address = result.results.A.frames[0].data.values[1][index]; var host_id = result.results.A.frames[0].data.values[2][index]; emit([hostname, address].join('|'), host_id) })}",
          "Schedule": "@every 5m"
        },
        {
          "ID": 2,
          "Name": "icingadb_service_id",
          "ParentDatasourceName": "Grafana",
          "DatasourceName": "IcingaDB",
          "Content": "SELECT t1.name AS hostname, t1.address, t2.name AS servicename, LOWER(HEX((t2.id))) as service_id FROM host t1 JOIN service t2 ON t1.id = t2.host_id",
          "ResultMapper": "function(result) { _.forEach(result.results.A.frames[0].data.values[0], function(hostname, index) { var address = result.results.A.frames[0].data.values[1][index]; var servicename = result.results.A.frames[0].data.values[2][index]; var service_id = result.results.A.frames[0].data.values[3][index]; emit([hostname, address, servicename].join('|'), service_id) }) }",
          "Schedule": "@every 5m"
        },
        {
          "ID": 3,
          "Name": "default_host_state_from_redis",
          "DatasourceID": 4,
          "Content": "local ks = redis.call('HKEYS', 'icinga:host:state')\nlocal ts = redis.call('HVALS', 'icinga:host:state')\nreturn {ks, ts}",
          "ResultMapper": "function(result) {\n  result[0].forEach(function(k, i) {\n    var obj = JSON.parse(result[1][i])\n    emit(k, obj['hard_state'])\n  })\n}                                                                                  ",
          "Schedule": "@every 5m"
        },
        {
          "ID": 4,
          "Name": "default_service_state_from_redis",
          "DatasourceID": 4,
          "Content": "local ks = redis.call('HKEYS', 'icinga:service:state')\nlocal ts = redis.call('HVALS', 'icinga:service:state')\nreturn {ks, ts}",
          "ResultMapper": "function(result) {\n  result[0].forEach(function(k, i) {\n    var obj = JSON.parse(result[1][i])\n    emit(k, obj['hard_state'])\n  })\n}                                                                            ",
          "Schedule": "@every 5m"
        },
        {
          "ID": 5,
          "Name": "default_in_ult_from_redis",
          "DatasourceID": 4,
          "Content": "local ks = redis.call('HKEYS', 'icinga:service:state')\nlocal ts = redis.call('HVALS', 'icinga:service:state')\nreturn {ks, ts}",
          "ResultMapper": "function(result) {\n  result[0].forEach(function(k, i) {\n    var obj = JSON.parse(result[1][i])\n    var performanceData = typeof obj['performance_data'] === 'string' ? obj['performance_data'] : '';\n\n    // Extract in_ult value using regex\n    var inUltMatch = performanceData.match(/in_ult=(\\d+)%/);\n    var inUltInt = inUltMatch ? parseInt(inUltMatch[1], 10) : 0;\n\n    // Convert to formatted string: \"0 %\"\n    var inUltValue = inUltInt + \" %\";\n\n    emit(k, inUltValue);\n  })\n}",
          "Schedule": "@every 5m"
        },
        {
          "ID": 6,
          "Name": "default_out_ult_from_redis",
          "DatasourceID": 4,
          "Content": "local ks = redis.call('HKEYS', 'icinga:service:state')\nlocal ts = redis.call('HVALS', 'icinga:service:state')\nreturn {ks, ts}",
          "ResultMapper": "function(result) {\n  result[0].forEach(function(k, i) {\n    var obj = JSON.parse(result[1][i])\n    var performanceData = typeof obj['performance_data'] === 'string' ? obj['performance_data'] : '';\n\n    // Extract in_ult value using regex\n    var outUltMatch = performanceData.match(/out_ult=(\\d+)%/);\n    var outUltInt = outUltMatch ? parseInt(outUltMatch[1], 10) : 0;\n\n    // Convert to formatted string: \"0 %\"\n    var outUltValue = outUltInt + \" %\";\n    emit(k, outUltValue);\n  })\n}",
          "Schedule": "@every 5m"
        },
        {
          "ID": 7,
          "Name": "default_in_ult_from_influxdb",
          "ParentDatasourceName": "Grafana",
          "DatasourceName": "influxdb_nms",
          "Content": "SELECT last(value) from \"Interface-check-command\" WHERE (time > now() - 5m) AND metric = 'in_ult' GROUP BY hostname, metric, service;",
          "ResultMapper": "function(result) { _.forEach(result.results[0].series, function(obj, index) { emit([obj.tags.hostname, obj.tags.service, obj.tags.metric].join('|'), obj.values[0][1]) })}",
          "Schedule": "@every 15m"
        },
        {
          "ID": 8,
          "Name": "default_out_ult_from_influxdb",
          "ParentDatasourceName": "Grafana",
          "DatasourceName": "influxdb_nms",
          "Content": "SELECT last(value) from \"Interface-check-command\" WHERE (time > now() - 5m) AND metric = 'out_ult' GROUP BY hostname, metric, service;",
          "ResultMapper": "function(result) { _.forEach(result.results[0].series, function(obj, index) { emit([obj.tags.hostname, obj.tags.service, obj.tags.metric].join('|'), obj.values[0][1]) })}",
          "Schedule": "@every 15m"
        },
        {
          "ID": 9,
          "Name": "default_rx_from_influxdb",
          "ParentDatasourceName": "Grafana",
          "DatasourceName": "influxdb_nms",
          "Content": "SELECT last(value) from \"Interface-check-command\" WHERE (time > now() - 5m) AND metric = 'OpticRX' GROUP BY hostname, metric, service;",
          "ResultMapper": "function(result) { _.forEach(result.results[0].series, function(obj, index) { emit([obj.tags.hostname, obj.tags.service, obj.tags.metric].join('|'), obj.values[0][1]) })}",
          "Schedule": "@every 15m"
        },
        {
          "ID": 10,
          "Name": "default_tx_from_influxdb",
          "ParentDatasourceName": "Grafana",
          "DatasourceName": "influxdb_nms",
          "Content": "SELECT last(value) from \"Interface-check-command\" WHERE (time > now() - 5m) AND metric = 'OpticTX' GROUP BY hostname, metric, service;",
          "ResultMapper": "function(result) { _.forEach(result.results[0].series, function(obj, index) { emit([obj.tags.hostname, obj.tags.service, obj.tags.metric].join('|'), obj.values[0][1]) })}",
          "Schedule": "@every 15m"
        },
        {
          "ID": 11,
          "Name": "default_critical_service_count_from_icingadb",
          "ParentDatasourceName": "Grafana",
          "DatasourceName": "IcingaDB",
          "Content": "SELECT t1.name AS hostname,t1.address, t3.hard_state, COUNT(t3.hard_state) AS hard_state_count FROM host t1 JOIN service t2 ON t1.id = t2.host_id JOIN service_state t3 ON t2.id = t3.service_id WHERE t2.name NOT LIKE 'If%' GROUP BY t1.id, t1.name, t1.address, t3.hard_state;",
          "ResultMapper": "function(result) { _.forEach(result.results.A.frames[0].data.values[0], function(hostname, index) { var address = result.results.A.frames[0].data.values[1][index]; var hard_state_count = result.results.A.frames[0].data.values[2][index]; emit([hostname, address].join('|'), { number_service_critical: hard_state_count }) }) }",
          "Schedule": "@every 15m"
        },
        {
          "ID": 12,
          "Name": "default_warning_service_count_from_icingadb",
          "ParentDatasourceName": "Grafana",
          "DatasourceName": "IcingaDB",
          "Content": "SELECT t1.name AS hostname,t1.address, t3.hard_state, COUNT(t3.hard_state) AS hard_state_count FROM host t1 JOIN service t2 ON t1.id = t2.host_id JOIN service_state t3 ON t2.id = t3.service_id WHERE t2.name NOT LIKE 'If%' GROUP BY t1.id, t1.name, t1.address, t3.hard_state;",
          "ResultMapper": "function(result) { _.forEach(result.results.A.frames[0].data.values[0], function(hostname, index) { var address = result.results.A.frames[0].data.values[1][index]; var hard_state_count = result.results.A.frames[0].data.values[2][index]; emit([hostname, address].join('|'), { number_service_warning: hard_state_count }) }) }",
          "Schedule": "@every 15m"
        },
        {
          "ID": 13,
          "Name": "default_red_alarm_count_from_icingadb",
          "ParentDatasourceName": "Grafana",
          "DatasourceName": "IcingaDB",
          "Content": "SELECT t1.name AS hostname, t1.address, t2.name AS servicename, t3.hard_state AS red_alarm_count FROM host t1 JOIN service t2 ON t1.id = t2.host_id JOIN service_state t3 ON t2.id = t3.service_id WHERE t2.name = 'Juniper_RedAlarm';",
          "ResultMapper": "function(result) {\n  _.forEach(result.results.A.frames[0].data.values[0], function(hostname, index) {\n    var address = result.results.A.frames[0].data.values[1][index];\n    // var servicename = result.results.A.frames[0].data.values[2][index];\n    var red_alarm_count = result.results.A.frames[0].data.values[3][index];\n\n    // Convert to integer safely\n    var number_red_alarm = parseInt(red_alarm_count, 10) || 0;\n\n    emit([hostname, address].join('|'), {\n      number_red_alarm: number_red_alarm\n    });\n  });\n}\n",
          "Schedule": "@every 15m"
        },
        {
          "ID": 14,
          "Name": "default_yellow_alarm_count_from_icingadb",
          "ParentDatasourceName": "Grafana",
          "DatasourceName": "IcingaDB",
          "Content": "SELECT t1.name AS hostname, t1.address, t2.name AS service_name, t3.hard_state AS yellow_alarm_count FROM host t1 JOIN service t2 ON t1.id = t2.host_id JOIN service_state t3 ON t2.id = t3.service_id WHERE t2.name = 'Juniper_YellowAlarm';",
          "ResultMapper": "function(result) {\n  _.forEach(result.results.A.frames[0].data.values[0], function(hostname, index) {\n    var address = result.results.A.frames[0].data.values[1][index];\n    // var servicename = result.results.A.frames[0].data.values[2][index];\n    var yellow_alarm_count = result.results.A.frames[0].data.values[3][index];\n\n    // Convert safely to integer\n    var number_yellow_alarm = parseInt(yellow_alarm_count, 10) || 0;\n\n    emit([hostname, address].join('|'), {\n      number_yellow_alarm: number_yellow_alarm\n    });\n  });\n}\n",
          "Schedule": "@every 15m"
        }
      ]
    }
  seed-queries-script.sh: |-
    #!/bin/sh
    # This script is used to get the datasourceID from MariaDB and Grafana and modify the queries seed file
    # to use the datasourceID from mariadb or Grafana
    
    #Step 0: Check if the required packages are installed. If not, install them
    echo -e "\n--- Step 0: Check if the required packages are installed. If not, install them"
    for pkg in curl jq mariadb-client; do
      if ! command -v "$pkg" >/dev/null 2>&1; then
        echo "Installing missing package: $pkg"
        apk add --no-cache "$pkg"
      fi
    done
    
    get_datasourceID_fromGrafana() {
      # grafana_host="${INTERNAL_GRAFANA_HOST:-grafana}"
      # grafana_port="${INTERNAL_GRAFANA_PORT:-3000}"
      grafana_url="${INTERNAL_GRAFANA_URL:-http://grafana:3000/grafana/}"
      grafana_user="${INTERNAL_GRAFANA_USER:-admin}"
      grafana_password="${INTERNAL_GRAFANA_PASSWORD:-admin}"
    
      local response=$(curl -s -u "${grafana_user}:${grafana_password}" \
        -H "Content-Type: application/json" \
        "${grafana_url}api/datasources")
      echo "$response"
    }
    
    get_datasourceID_fromMariadb() {
      local parent=$1
      local name=$2
      if [[ "$parent" != "Grafana" ]]; then
        echo 9999
        return
      fi
      grafana_datasource_ID=$(mariadb -u "$USER" -p"$PASS" -h "$MARIADB_HOST" -D "$DB" --skip-ssl -Nse "SELECT id FROM datasources WHERE type='Grafana' AND title='internal_grafana' LIMIT 1;")
      local query="SELECT id FROM datasources WHERE parent_id='$grafana_datasource_ID' AND title='$name' LIMIT 1;"
      local id=$(mariadb -u "$USER" -p"$PASS" -h "$MARIADB_HOST" -D "$DB" --skip-ssl -Nse "$query")
      if [[ -n "$id" ]]; then
        echo $((id))
      else
        echo 9999
      fi
    }
    
    main () {
      if [[ "$1" != "-seed" || -z "$2" ]]; then
        echo "Usage: $0 -seed <INPUT_FILE.yml>"
        exit 1
      fi
    
      INPUT_FILE="$2"
      INPUT_FILE_NAME=$(basename "$INPUT_FILE")
    
      if [[ ! -f "$INPUT_FILE" ]]; then
        echo "❌ Input file '$INPUT_FILE' not found!"
        exit 1
      fi
    
      # Automatically derive output filename
      OUTPUT_FILE="/tmp/${INPUT_FILE_NAME%.*}_with_ids.json"
    
      #Step 1: Get the datasourceID from Grafana
      echo -e "\n--- Step 1: Get the datasourceID from Grafana"
      response_from_grafana=$(get_datasourceID_fromGrafana)
      echo "response_from_grafana: $response_from_grafana"
    
      #Step 2: Check connection to the database mariadb
      echo -e "\n--- Step 2: Check connection to the database mariadb"
      # Parse DATABASE_URL if defined
      if [ -n "$DATABASE_URL" ]; then
        USER=$(echo "$DATABASE_URL" | cut -d':' -f1)
        PASS=$(echo "$DATABASE_URL" | cut -d':' -f2 | cut -d'@' -f1)
        MARIADB_HOST=$(echo "$DATABASE_URL" | sed -n 's/.*@tcp(\(.*\):.*/\1/p')
        MARIADB_PORT=$(echo "$DATABASE_URL" | sed -n 's/.*@tcp(.*:\(.*\)).*/\1/p')
        DB=$(echo "$DATABASE_URL" | sed -n 's|.*/\([^/?]*\).*|\1|p')
      fi
    
      # Set defaults if individual values are still not set
      USER="${USER:-backend}"
      PASS="${PASS:-backend}"
      MARIADB_HOST="${MARIADB_HOST:-mariadb}"
      MARIADB_PORT="${MARIADB_PORT:-3306}"
      DB="${DB:-svtech}"
      row_count=$(mariadb -u "$USER" -p"$PASS" -h "$MARIADB_HOST" -D "$DB" --skip-ssl -Nse "SHOW DATABASES;")
      if [ $? -ne 0 ]; then
        echo "❌ Failed to connect database '$DB' from host 'MARIADB_HOST'. Exiting..."
        exit 1
      fi
    
      query_count=$(mariadb -u "$USER" -p"$PASS" -h "$MARIADB_HOST" -P "$MARIADB_PORT" -D "$DB" --skip-ssl -Nse \
        "SELECT COUNT(*) FROM queries;" 2>/dev/null)
    
      if [ $? -ne 0 ]; then
        echo "⚠️ Table 'queries' does not exist or cannot be queried. Proceeding with seeding..."
      else
        if [ "$query_count" -gt 0 ]; then
          echo "✅ Table 'queries' already has data ($query_count rows). Do not init seed query!."
          exit 0
        fi
      fi
    
      #Step 3: Modify the datasource seed file to use datasourceID from mariadb or Grafana
      echo -e "\n--- Step 3: Modify the datasource seed file to use datasourceID from mariadb or Grafana"
      # INPUT_FILE="datasource_file.yml"
      # OUTPUT_FILE="datasource_file_with_ids.json"
    
      echo '{' > "$OUTPUT_FILE"
      echo '  "Query": [' >> "$OUTPUT_FILE"
      first=1
    
      jq -c '.Query[]' "$INPUT_FILE" | while read -r block; do
        parent=$(echo "$block" | jq -r '.ParentDatasourceName')
        name=$(echo "$block" | jq -r '.DatasourceName')
        raw_ds_id=$(echo "$block" | jq -r '.DatasourceID')
        # Determine which DatasourceID to use
        # We first check if the DatasourceID is already set in the block of datasource seed file
        # If it is not set, we check if the datasource is Grafana
        # If it is not Grafana, we get the DatasourceID from mariadb first
        # If it is Grafana, we get the DatasourceID from Grafana API
        # Finnally, if the DatasourceID is still not set, we set it to 9999
        if [[ -z "$raw_ds_id" || "$raw_ds_id" == "null" ]]; then
          ds_id=$(get_datasourceID_fromMariadb "$parent" "$name")
          if [[ "$ds_id" -eq 9999 ]]; then
            echo "❌ DatasourceID not found for $parent/$name in mariadb. Try grafana"
            if [[ -z "$response_from_grafana" ]]; then
              echo "❌ No response from Grafana API. Exiting..."
              exit 1
            fi
            id=$(echo "$response_from_grafana" | jq -r --arg name "$name" '.[] | select(.name == $name) | .id')
            if [[ -n "$id" && "$id" != "null" ]]; then
              ds_id=$((id + 5)) #the datasourceID of Grafana Internal should be set to 5
            else
              ds_id=9999
            fi
          fi
        else
          ds_id=$raw_ds_id
        fi
    
        # Write the modified block to the output file
        # Remove ParentDatasourceName and DatasourceName, and add DatasourceID
        # If the block is empty, we set the DatasourceID to 9999
        new_block=$(echo "$block" | jq --argjson id "$ds_id" 'del(.ParentDatasourceName, .DatasourceName) + {DatasourceID: $id}')
        if [[ $first -eq 1 ]]; then
          echo "  $new_block" >> "$OUTPUT_FILE"
          first=0
        else
          echo "  ,$new_block" >> "$OUTPUT_FILE"
        fi
      done
    
      echo "  ]" >> "$OUTPUT_FILE"
      echo "}" >> "$OUTPUT_FILE"
      echo "✅ New file written to: $OUTPUT_FILE"
    
      #Step 4: Load the modified queries seed file into the database
      echo -e "\n--- Step 4: Load the modified queries seed file into the database"
      /server --seed "$OUTPUT_FILE"
    }
    
    main "$@"
---
# Source: topology-app/templates/topology-app-env.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: topology-app-env
data:
  BACKEND_URL: "http://topology-app/api/v1/traefik"
  DATABASE_URL: "user:password@tcp(mariadb:3306)/dbname?parseTime=true"
  FRONTEND_URL: "http://topology-web"
  PORT: "4000"
  REDIS_ADDRESS: "redis:6379"
  UPLOAD_DIR: "/data"
  PERMISSIONS_ENABLED: "true"
  TRAEFIK_TEMPLATE: "/opt/traefik.yaml"
---
# Source: topology-app/templates/traefik-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: traefik-config
data:
  traefik.yaml: |-
    http:
      middlewares:
        cors:
          headers:
            frameDeny: false
            browserXssFilter: false
            stsSeconds: 15768000
            contentSecurityPolicy: "style-src 'self' 'unsafe-inline';"
            customResponseHeaders:
              Access-Control-Allow-Credentials: "true"
              Access-Control-Allow-Headers: "Origin, X-Requested-With, Content-Type, Accept, Authorization"
              Access-Control-Allow-Methods: "GET,POST,PUT,DELETE,OPTIONS"
              Access-Control-Allow-Origin: "*"
        # dashboard-auth:
        #   basicAuth:
        #     users:
        #       - "<dummy-fill up when applying>"
        # grafana-auth:
        #   headers:
        #     customRequestHeaders:
        #       Authorization: "<dummy-fill up when applying>"

      routers:
        default:
          middlewares: []
          rule: "PathPrefix(`/`)"
          service: ""
        default-tls:
          middlewares: []
          rule: "PathPrefix(`/`)"
          service: ""
          tls: {}
        backend:
          middlewares:
            - "cors"
          priority: 100
          rule: "PathPrefix(`/public`) || PathPrefix(`/api/v1`)"
          service: "backend"
        backend-tls:
          middlewares:
            - "cors"
          priority: 100
          rule: "PathPrefix(`/public`) || PathPrefix(`/api/v1`)"
          service: "backend"
          tls: {}
        dashboard:
          middlewares: []
          rule: "(PathPrefix(`/api`) || PathPrefix(`/dashboard`))"
          service: "api@internal"
        dashboard-tls:
          middlewares: []
          rule: "PathPrefix(`/dashboard`)"
          service: "dashboard"
          tls: {}
        frontend:
          middlewares:
            - "cors"
          rule: >-
            Path(`/`) || PathPrefix(`/login`) || PathPrefix(`/logout`) ||
            PathPrefix(`/admin`) || PathPrefix(`/app`) || PathPrefix(`/build`) ||
            PathPrefix(`/api/visualizer`) || PathPrefix(`/api/datasources`) ||
            PathPrefix(`/api/metadata`) || PathPrefix(`/api/queries`) ||
            PathPrefix(`/api/templates`)
          service: "frontend"
        frontend-tls:
          middlewares:
            - "cors"
          rule: >-
            Path(`/`) || PathPrefix(`/login`) || PathPrefix(`/logout`) ||
            PathPrefix(`/admin`) || PathPrefix(`/app`) || PathPrefix(`/build`) ||
            PathPrefix(`/api/visualizer`) || PathPrefix(`/api/datasources`) ||
            PathPrefix(`/api/metadata`) || PathPrefix(`/api/queries`) ||
            PathPrefix(`/api/templates`)
          service: "frontend"
          tls: {}

      #   icingaweb:
      #     middlewares:
      #       - "cors"
      #     rule: "PathPrefix(`/icingaweb`)"
      #     service: "icingaweb"
      #   icingaweb-tls:
      #     middlewares:
      #       - "cors"
      #     rule: "PathPrefix(`/icingaweb`)"
      #     service: "icingaweb"
      #     tls: {}
      #   grafana:
      #     middlewares:
      #       - "cors"
      #       # - "grafana-auth"
      #     rule: "PathPrefix(`/grafana`)"
      #     service: "grafana"
      #   grafana-tls:
      #     middlewares:
      #       - "cors"
      #       # - "grafana-auth"
      #     rule: "PathPrefix(`/grafana`)"
      #     service: "grafana"
      #     tls: {}
      #   rundeck:
      #     middlewares:
      #       - "cors"
      #     rule: "PathPrefix(`/rundeck`)"
      #     service: "rundeck"
      #   rundeck-tls:
      #     middlewares:
      #       - "cors"
      #     rule: "PathPrefix(`/rundeck`)"
      #     service: "rundeck"
      #     tls: {}
      #   topology:
      #     middlewares:
      #       - "cors"
      #     rule: "PathPrefix(`/topology`)"
      #     service: "topology"
      #   topology-tls:
      #     middlewares:
      #       - "cors"
      #     rule: "PathPrefix(`/topology`)"
      #     service: "topology"
      #     tls: {}
      #   gitlist:
      #     middlewares:
      #       - "cors"
      #     rule: "PathPrefix(`/gitlist`)"
      #     service: "gitlist"
      #   gitlist-tls:
      #     middlewares:
      #       - "cors"
      #     rule: "PathPrefix(`/gitlist`)"
      #     service: "gitlist"
      #     tls: {}

      serversTransports:
        localssl:
          insecureSkipVerify: true

      services:
        backend:
          loadBalancer:
            servers:
              - url: "http://topology-app"
        frontend:
          loadBalancer:
            servers:
              - url: "http://topology-web"
      #   icingaweb:
      #     loadBalancer:
      #       servers:
      #         - url: "http://icingaweb:8080/icingaweb/"
      #   grafana:
      #     loadBalancer:
      #       servers:
      #         - url: "http://grafana:3000/grafana/"
      #   rundeck:
      #     loadBalancer:
      #       servers:
      #         - url: "http://rundeck:4440/rundeck"
      #   topology:
      #     loadBalancer:
      #       servers:
      #         - url: "http://nagvis:80/nagvis/"
      #   gitlist:
      #     loadBalancer:
      #       servers:
      #         - url: "http://gitlist:80/gitlist/"
      #   csv:
      #     loadBalancer:
      #       servers:
      #         - url: "http://proxy:80/csv/"
      #   static_csv:
      #     loadBalancer:
      #       servers:
      #         - url: "http://proxy:80/static_csv/"

    tls:
      stores:
        default:
          defaultCertificate:
            certFile: /tls/tls.crt
            keyFile: /tls/tls.key
      certificates:
        - certFile: /tls/tls.crt
          keyFile: /tls/tls.key
---
# Source: topology-app/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: topology-app
  labels:
    app.kubernetes.io/name: topology-app
    helm.sh/chart: topology-app-0.1.0
    app.kubernetes.io/instance: topo
    app.kubernetes.io/managed-by: Helm
spec:

  selector:
    app.kubernetes.io/name: topology-app
    app.kubernetes.io/instance: topo

  type: ClusterIP

  ports:
    - name: topology-app
      port: 80
      targetPort: 4000
      protocol: TCP
---
# Source: topology-app/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: topo-topology-app
  labels:
    app.kubernetes.io/name: topology-app
    helm.sh/chart: topology-app-0.1.0
    app.kubernetes.io/instance: topo
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: topology-app # replace if needed
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: topology-app
      app.kubernetes.io/instance: topo
      app.kubernetes.io/component: topology-app # replace if needed
  template:
    metadata:
      labels:
        app.kubernetes.io/name: topology-app
        helm.sh/chart: topology-app-0.1.0
        app.kubernetes.io/instance: topo
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/component: topology-app # replace if needed
    spec:
      # Allocate pods to nodes
      affinity:
        podAffinity:
          
        podAntiAffinity:
          
        nodeAffinity:
          

      imagePullSecrets:
      - name: ghcr-pull-secret
      securityContext:
        {}

      # initContainers
      initContainers:
        - name: init-seed
          securityContext:
            {}
          # set to image: moophat/topology-app:latest if using docker.io as registry
          image: ghcr.io/moophat/topology-app:latest
          imagePullPolicy: IfNotPresent
          command:
            - /bin/sh
            - -c
            - |
              # init database with seed files
              ../server -migrate -seed /opt/seed-groups.yaml -seed /opt/seed-users.yaml -seed /opt/seed-resource-types.yaml -seed /opt/seed-permissions.yaml -seed /opt/seed-dashboards.yaml -seed /opt/seed-menu-items.yaml -seed /opt/seed-datasources.yaml -seed /opt/seed-states.yaml -seed /opt/seed-templates.yaml -seed /opt/seed-icons.yaml
              # # wait for grafana to be ready
              # until $(curl --output /dev/null -k --silent --head --fail https://192.168.1.1/grafana/api/health); do
              #     printf '.'
              #     sleep 5
              # done
              # echo "Grafana is up - get datasource from grafana and init seed-queries"
              /opt/seed-queries-script.sh -seed /opt/seed-queries.yaml
          env:
            - name: TZ
              value: "Asia/Ho_Chi_Minh"
          envFrom:
            - configMapRef:
                name: topology-app-env

          volumeMounts:
            # shareVolume: VolumeMount
            # unshareVolume(volumeMount): define in the chart's values.yaml
            - mountPath: /opt
              name: seed-configs

      # Containers config
      containers:
        # Server container
        - name: topology-app-server # replace if needed
          securityContext:
            {}
          # set to image: moophat/topology-app:latest if using docker.io as registry
          image: ghcr.io/moophat/topology-app:latest
          imagePullPolicy: IfNotPresent
          ports:
            - name: topology-app
              containerPort: 4000
              protocol: TCP
          command:
            - /bin/sh
            - -c
            - |
              ../server -server -migrate
          env:
            - name: TZ
              value: "Asia/Ho_Chi_Minh"
          envFrom:
            - configMapRef:
                name: topology-app-env
          resources:
            {}
          volumeMounts:
            # shareVolume: VolumeMount
            # unshareVolume(volumeMount): define in the chart's values.yaml
            - mountPath: /opt
              name: seed-configs

        # Worker container
        - name: topology-app-worker # replace if needed
          securityContext:
            {}
          # set to image: moophat/topology-app:latest if using docker.io as registry
          image: ghcr.io/moophat/topology-app:latest
          imagePullPolicy: IfNotPresent
          command:
            - /bin/sh
            - -c
            - |
              ../server -worker -migrate
          env:
            - name: TZ
              value: "Asia/Ho_Chi_Minh"
          envFrom:
            - configMapRef:
                name: topology-app-env
          resources:
            {}
          volumeMounts:
            # shareVolume: VolumeMount
            # unshareVolume(volumeMount): define in the chart's values.yaml
            - mountPath: /opt
              name: seed-configs

      volumes:
      # shareVolume(volume): define in the global values
      # unshareVolume(volume): define in the chart's values.yaml
        - name: seed-configs
          projected:
            defaultMode: 493
            sources:
            - configMap:
                name: seed-configs
            - configMap:
                name: traefik-config
